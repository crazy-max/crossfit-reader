language: java
jdk: oraclejdk8
sudo: required
dist: trusty

env:
  - secure: "GoybS/XSaoi/NTUfRXD/c58KkYT/hOeFJJAWhp4qchPxy6HLTODWbRfhKYTDabgQ8lBr0kYopt7ENpI2u+Nl+s2NBFg9zNzvbxjg5xGKYDZhDEgkcBbnmu3SFc8QkuNhZXerct2k9mYB7sfL7RXzUOvn6m7M8laPlPkmOMivyRRKhCooMxeCFGOY2CCtwcUb5p9xFO+AfF+Oo0jAO6y7E8h4Pr2Bi2QLneoU32laJmPz9TJDCbZAJLXmxtssvcNhdXN8Z8DJvlShR1+f12QvcptgNlewuC7GFKsBiTfKsA6NMrgTftJe9W3mpVsbz2GyC3hoaF0eTw77FKlKoe7eamhNfeFuWnRjXYT3NqrXwzd7s4So//w5qe14ld1+zica9YSK/utJRxO44XnvCUai6lbB8N6LEGplMLhwWJa/GpyC5YvCrkb0su7CxMpThsaHVPVS15x1oIpOehCG6mH/SxsjdvrBVB6FPMwN3PRr/dNOIhNh5PGI6PWMgj2zUleFzw5hvgPTElsgq1xUnjCo98XHuScMmkKHcXAWDwrAmOVznQxTGoK2cH2F3AC4JaodNa/AZDWMhUtr2k2LproA5Xt5qfUWopu1NENl37IWu5euY4QTS6oNpCqMIvlED8KA77ZRgxmO0h4QhdTwohRmCeY23EJhZjRRQ6OolNcfoM8="

before_install:
  - sudo dpkg --add-architecture i386
  - sudo add-apt-repository -y ppa:arx/release
  - sudo add-apt-repository -y ppa:ubuntu-wine/ppa
  - sudo apt-get update
  - sudo apt-get install -y -q innoextract wine python-software-properties
  - export DISPLAY=:99.0
  - sh -e /etc/init.d/xvfb start
  - sleep 3
  - wine --version
  - innoextract --version
  - sh src-build/travisSwitchJdk.sh
  - source ~/.bash_profile
  - export APP_VERSION=`sed '/^\#/d' build.properties | grep '^app.version' | tail -n 1 | cut -d "=" -f2- | sed 's/^[[:space:]]*//;s/[[:space:]]*$//'`
  - echo $APP_VERSION

script:
  - gradle antClean getDeps antRelease

after_success:
  - export PREVIOUS_VERSION=`git describe --abbrev=0 --tags | cut -c 2-`
  - echo $PREVIOUS_VERSION
  - sh src-build/travisTag.sh
  - source ~/.bash_profile

deploy:
  provider: releases
  skip_cleanup: true
  api_key:
    - secure: HK49CZDJGtB9wTjyah60XRNNKUEmvJcAhq0fsPZrsRUptj0fixNfjJWTTGSno3rER6l+2dBcuSm3hFBsog3dDUcAd5Jm5rGIR4SsZ66H+PXePJXynMZ9p1k9Yeox3iSuGy/mTkj0TkT7QV2GhEXYQkfPrK+iPTsmnlmjIehTCrIxse02wUrRqnbr36YkIBZZm9fSdPjcPRUqvnVta0q/meDQOqICH5oaKqoXiS4OlARFjpi3j7toxjnMPTfIsACR2HUgNeZ2kiPhOkco60+cze3yW99NHq0XogP3S2iT9HJBsM6CQSJVoKplkx6kmMqk4Emdsv7k79lAKkUqTq0AltnzFqYGe+16oo0q3LBjuXM8Gkjz4YqAbnKgOa5Lx+sYdGS5w2Vz/ycA+rfiefBOMf/VxdaF4QxMZ0g56quDO8Akrx3n1p9QU710Hk4CazyaK733I7mZ6k6Rgp1hQrpHJSqGzJMnJ+mnOAdCNy42WbNDQzXbSHbZApERWA1mQsBd/XT/uUXCYa9Tb8mSAfHYyvYDsAanF1U2QyoO5gZ3HCUt1bFMrJudtRkBj2gcFretu2io3qseJ/Fp6I7MJz4qp/6Edgs9+p8KGQhZKDA+n8I23BexUOZOnKNpNUau4EwF2NJQ5IWDEdWQoAdWk3BqKreC0fnTqWxvf7qyzOF4JdM=
  file:
    - build/ant/setup/crossfit-reader-setup.exe
  on:
    condition: $DO_DEPLOY = 1
    repo: crazy-max/crossfit-reader
    tags: false

branches:
  except:
    - /^v[0-9]/
